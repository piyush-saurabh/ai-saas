This repo is created based on tutorial https://youtu.be/ffJ38dBzrlY

Original Repo:
https://github.com/AntonioErdeljac/next13-ai-saas

Use icons from here
https://lucide.dev/icons/

Install Prisma Extension for vscode
https://marketplace.visualstudio.com/items?itemName=Prisma.prisma


## Setup

Ref: https://ui.shadcn.com/docs/installation/next 

**Create the project**

```
npx create-next-app@latest ai-saas --typescript --tailwind --eslint 
```

**Setup the project**
```
npx shadcn-ui@latest init
```

**Packages**
```
# OpenAI
npm i openai

# Axios (for sending HTTP request from frontend)
npm i axios

# react-markdown (for displaying the markdown content, e.g code output) 
npm i react-markdown

# Replicate (for music generation)
npm i replicate

# Prisma (for tracking free tier limit)
npm i -D prisma

# Prisma Client
npm i @prisma/client
```

**Run the project**

```
// Runs on locahost:3000
npm run dev
```

### Shadcn Components

**Button**
```
npx shadcn-ui@latest add button
```

**Sheet** (Menu for small/mobile screen)
```
npx shadcn-ui@latest add sheet
```

**Card** (for dashboard)
```
npx shadcn-ui@latest add card
```

**Form** (for conversation)
```
npx shadcn-ui@latest add form
```

**Input** (for form)
```
npx shadcn-ui@latest add input
```

**Avatar** (for user in conversation)
```
npx shadcn-ui@latest add avatar
```

**Select** (In image generation to select number of images)
```
npx shadcn-ui@latest add select
```

**Progress** (for showing the limit in free tier)
```
npx shadcn-ui@latest add progress
```

## Notes

* Shadcn UI is a CSS framework. All the components (e.g. button) installed using shadcn will be stored in /components folder.


### Folder Structure
* /app will contain all our routes
    * /app/globals.css: generated by shadcn ui
    * /app/page.tsx will be the default route /
* /components will have components from shadcn
* /lib/utils.ts will be used to merge tailwind classes
* 

## Routing
* /app/page.tsx will be the default route /
* /app/test/page.tsx will be located at /test
* We can use **Route Groups** to have a folder inside /app folder without having route on that. More details: https://nextjs.org/docs/app/building-your-application/routing/route-groups
    * add parenthesis around the folder to avoid effecting the route.

## Authentication

Provider: https://clerk.com/

**Setup**

Ref: https://clerk.com/docs/nextjs/get-started-with-nextjs

```
# Install Clerk
npm install @clerk/nextjs

# Import Clerk Provider in /app/layout.tsx
import { ClerkProvider } from '@clerk/nextjs'

```

Wrap entire application inside Clerk Provider
```
return (
    <ClerkProvider>
      <html lang="en">
      <body className={inter.className}>{children}</body>
    </html>
    </ClerkProvider>
    
  )
```

Create a file `middleware.ts` in application root and paste the content
```
import { authMiddleware } from "@clerk/nextjs";

// This example protects all routes including api/trpc routes
// Please edit this to allow other routes to be public as needed.
// See https://clerk.com/docs/nextjs/middleware for more information about configuring your middleware
export default authMiddleware({});

export const config = {
  matcher: ["/((?!.*\\..*|_next).*)", "/", "/(api|trpc)(.*)"],
};

```

Clerk nees to have the folder `sign-in/[[...sign-in]]` and `sign-up/[[...sign-up]]` for the authentication to work. We can name the folder to anything but but the folder should have same name.

By default all the routes will be protected. We have to explicitly add public route in `middleware.ts` file


## Database Setup

Initialize Prisma. It will create a new folder `prisma`
```
npx prisma init
```

**Setup Planetscale** (serverless MSQL database)
Go to https://planetscale.com/ > Create new database > Generate new password > Copy the connection string to .env > Copy the schema to /prisma/schema.prisma

Model for our table will be created in schema.prisma

**Model defination**
```
model userApiLimit {
  id String @id @default(cuid())
  userId String @unique
  count Int @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

Push the model to the database and add the models to the node modules (generate). This has to be done everytime we modify the model
```
# This will create a table
npx prisma db push

# This will add the models in node modules so that we can use them during development
npx prisma generate
```

View the data (http://localhost:5555/)
```
npx prisma studio
```

### Quering using prisma

**Create a prisma client**
File: lib/prismadb.ts
```
import { PrismaClient } from "@prisma/client";

declare global {
    var prisma: PrismaClient | undefined;
}

// Prevent multiple prisma client from getting created
const prismadb = globalThis.prisma || new PrismaClient();
if (process.env.NODE_ENV !== "production") globalThis.prisma = prismadb;

export default prismadb;
```

**Check if row exists (READ)**
```
// here 'userId' is a column
await prismadb.modelName.findUnique({
        where: {
            userId: userId
        }
    });
```

**Create a new record (CREATE)**
```
// here 'userId' and 'count' are columns of a table
// Note: Create does not require to provide values for all the columns. Other columns will be null
await prismadb.modelName.create({
            data: {userId: userId, count: 1}
        });
```

**Update an existing record (UPDATE)**
```
// here 'count' is a column
await prismadb.modelName.update({
            where: {userId: userId},
            data: { count: userApiLimit.count + 1 }
        });
```



